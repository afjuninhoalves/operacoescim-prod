<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <title>Operações</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background: #0f172a;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    .wrap {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 16px;
    }

    .btn {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 8px;
      background: #2563eb;
      color: #fff;
      text-decoration: none;
      font-weight: 600;
    }

    .btn:hover {
      background: #1d4ed8;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #111827;
      border-radius: 12px;
      overflow: hidden;
    }

    th,
    td {
      padding: 10px 12px;
      border-bottom: 1px solid #1f2937;
      text-align: left;
      vertical-align: middle;
    }

    th {
      color: #9ca3af;
    }

    .top-actions {
      margin: 0 0 12px 0;
      display: flex;
      gap: 8px;
    }

    .pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: #0b1325;
      border: 1px solid #1f2937;
      color: #93c5fd;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h2 style="margin:0 0 12px 0;">Operações</h2>

    <div class="top-actions">
      <% if (['admin','gestor'].includes(user.role)) { %>
        <a class="btn" href="/operacoes/nova">Nova operação</a>
        <% } %>
          <a class="btn" href="/">Voltar</a>
    </div>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Início (agendado)</th>
          <th>Status</th>
          <th>Participantes</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <% if (operacoes.length) { %>
          <% operacoes.forEach(function(op){ %>
            <tr>
              <td>
                <%= op.id %>
              </td>
              <td>
                <%= op.nome %>
              </td>
              <td>
                <%= new Date(op.inicio_agendado).toLocaleString('pt-BR') %>
              </td>
              <td><span class="pill">
                  <%= op.status %>
                </span></td>
              <td>
                <%= (participantes[op.id] || []).join(', ') %></td>
              <td>
                <div class="btn-row">
                  <% if (user && (user.role === ' admin' || user.role==='gestor' )) { %>
                  <a class="btn" href="/operacoes/<%= op.id %>/editar">Editar</a>
                  <% } %>

                    <a class="btn" href="/operacoes/<%= op.id %>">Abrir</a>
                    <% if (['admin','gestor'].includes(user.role)) { %>
                      <a class="btn" href="/operacoes/<%= op.id %>/monitor">Monitorar</a>
                      <a class="btn" href="/operacoes/<%= op.id %>/fotos">Fotos</a>
                      <% } %>
  </div>

  </td>
  </tr>
  <% }) %>
    <% } else { %>
      <tr>
        <td colspan="6">Nenhuma operação encontrada.</td>
      </tr>
      <% } %>
        </tbody>
        </table>
        </div>
</body>

</html>